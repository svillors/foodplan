# Foodplan
Проект - сервис для подбора и управления меню на основе персональных предпочтений пользователя. Пользователь может зарегистрироваться, указать свои предпочтения (например, типы блюд, аллергенные продукты), оформить подписку, получать ежедневное меню и менять блюда в меню ограниченное число раз в день. Система автоматически подбирает рецепты на завтрак, обед, ужин и десерт, учитывая предпочтения пользователя.

## Функциональность
- Регистрация и аутентификация пользователей по email.

- Управление профилем: обновление имени, просмотр состояния подписки.

- Оформление и активация подписки (на 30 дней).

- Автоматическая генерация ежедневного меню на основе предпочтений пользователя и системы тегов.

- Возможность замены блюда в меню ограниченное количество раз в день.

- Просмотр деталей рецепта.

- Административная панель для управления пользователями, рецептами, ингредиентами, тегами и ежедневными меню.

- Демо оплата заказа.

## Модели
`Пользователь (CustomUser)`
- Авторизация по email.
- Поля: email, first_name, подписка (активна/нет, дата окончания), предпочтения (теги), аватар.

`Ингредиент (Ingredient)`
- Название, единица измерения, цена и калории на единицу.

`Тег (Tag)`
- Название, категория (тип меню, приём пищи, аллергия).

`Рецепт (Recipe)`
- Название, описание, изображение, ингредиенты (через IngredientItem), теги.
- Свойства: общая калорийность и стоимость.

`Ежедневное меню (DailyMenu)`
- Пользователь, дата, рецепты, количество доступных замен блюд.
- Связующая модель ингредиентов (IngredientItem)
- Рецепт, ингредиент, количество, вычисление цены и калорийности.

## Функциональность
`Формы (forms.py)`
- CustomUserCreationForm - регистрация пользователя с кастомными полями.
- UserUpdateForm - обновление профиля.

Вспомогательные функции (utils.py)
- get_random_recipe_by_prefers() - возвращает случайный рецепт по приёму пищи и предпочтениям пользователя, исключая указанный рецепт.

- meal_index() - определяет индекс приёма пищи для сортировки рецептов.

`Вьюхи (views.py)`
- register_view - регистрация пользователя.

- login_view - вход в систему.

- lk_view - личный кабинет: отображение меню, подписки, обновление имени.

- change_recipe - замена блюда в меню.

- activate_subscription - активация подписки.

- subscribe - страница оформления подписки.

- recipe_details - просмотр подробностей рецепта.

`URL-маршруты (urls.py)`
- /admin/ - админ панель

- /register/ - регистрация

- /auth/ - вход

- /lk/ - личный кабинет

- /lk/change_recipe/ - замена блюда

- /logout/ - выход

- /subscribe/ - подписка

- /order/ - оформление заказа

## Админка (admin.py)
- Управление пользователями, рецептами, ингредиентами, ежедневными меню и тегами.
- В рецепте отображаются ингредиенты с единицами измерения.

## Установка
1. Клонируйте репозиторий и установите зависимости:
```bash
    pip install -r requirements.txt
```

2. Необходимо создать .env файл:
```bash
    SECRET_KEY=ваш_секретный_ключ
    DEBUG=ваша_настройка
    ALLOWED_HOSTS=ваша_настройка
```

3. Настройте проект Django, указав необходимые параметры в файле settings.py.
```bash
    LANGUAGE_CODE = 'ru'
    TIME_ZONE = 'Europe/Moscow'
    USE_I18N = True
    USE_TZ = True


    INSTALLED_APPS = [
        ....
    'your_name_apps',]

    SECRET_KEY = env.str('SECRET_KEY')
    TG_BOT_TOKEN = env.str('TG_BOT_TOKEN')
    PAY_TG_TOKEN = env.str('PAY_TG_TOKEN')
    SECRET_KEY = env.str('SECRET_KEY')
    DEBUG = env.bool('DEBUG', default=False)
    ALLOWED_HOSTS = env.list('ALLOWED_HOSTS')
```

4. Создайте базу данных и примените миграции, создайте админ пользователя:
```bash
    python manage.py makemigrations
    python manage.py migrate
    python manage.py createsuperuser
```

5. Для загрузки рецптов (затем в media скопировать папку recipes_img):
```bash
    python manage.py loaddata recipes/fixtures/initial_recipes.json

```
6. Запустите сервер:

```bash
    python manage.py runserver
```

## Настройка
Для работы с изображениями и аватарами настройте `MEDIA_ROOT` и `MEDIA_URL` в `settings.py.`

Убедитесь, что в проекте подключено приложение `recipes` и кастомная модель пользователя `(AUTH_USER_MODEL = 'yourapp.CustomUser')`.

## Примечания
- Для генерации меню используются теги: предпочтения пользователя и типы приёмов пищи `(завтрак, обед, ужин, десерт)`.

- Пользователь может менять блюда в меню ограниченное число раз в день (change_count).

- Все основные действия защищены авторизацией.

## Лицензия
MIT